# BUMA Wallet - Architecture Visualization

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PRESENTATION LAYER (To Be Built)                     â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Login UI    â”‚  â”‚ Wallet UI    â”‚  â”‚ Transfer UI  â”‚  â”‚ History UI   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    Uses Repositories via DI
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOMAIN LAYER                                          â”‚
â”‚                  (Business Logic - Framework Independent)                    â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          ENTITIES (Immutable)                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚   User   â”‚  â”‚ Wallet â”‚  â”‚ Transaction â”‚  â”‚AuthToken â”‚             â”‚  â”‚
â”‚  â”‚  â”‚          â”‚  â”‚        â”‚  â”‚             â”‚  â”‚          â”‚             â”‚  â”‚
â”‚  â”‚  â”‚ id       â”‚  â”‚balance â”‚  â”‚ id          â”‚  â”‚access    â”‚             â”‚  â”‚
â”‚  â”‚  â”‚ email    â”‚  â”‚currencyâ”‚  â”‚ recipientEmâ„œ  â”‚ refresh  â”‚             â”‚  â”‚
â”‚  â”‚  â”‚ name     â”‚  â”‚updated â”‚  â”‚ amount      â”‚  â”‚ expiry   â”‚             â”‚  â”‚
â”‚  â”‚  â”‚          â”‚  â”‚        â”‚  â”‚ status*     â”‚  â”‚          â”‚             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ timestamp   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚  â”‚                    *Status: pending|success|failed|pendingSync         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    REPOSITORY INTERFACES                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚  AuthRepository      â”‚      â”‚  WalletRepository          â”‚        â”‚  â”‚
â”‚  â”‚  â”‚                      â”‚      â”‚                            â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ + login(...)         â”‚      â”‚ + getWalletBalance()       â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ + register(...)      â”‚      â”‚ + transferFund(...)        â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ + logout()           â”‚      â”‚ + getTransactionHistory()  â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ + getCurrentUser()   â”‚      â”‚ + syncPendingTransactions()â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ + isAuthenticated()  â”‚      â”‚                            â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    FAILURE UNION TYPES                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Network    â”‚  â”‚ Server     â”‚  â”‚ Cache      â”‚  â”‚ Auth       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ Failure    â”‚  â”‚ Failure    â”‚  â”‚ Failure    â”‚  â”‚ Failure    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ (No inet)  â”‚  â”‚ (4xx, 5xx) â”‚  â”‚ (DB error) â”‚  â”‚ (Bad creds)â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚  â”‚  â”‚ Validation     â”‚  â”‚ Unknown        â”‚                             â”‚  â”‚
â”‚  â”‚  â”‚ Failure        â”‚  â”‚ Failure        â”‚                             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  Returns: Either<Failure, Success> for all operations                       â”‚
â”‚  No exceptions thrown - errors are values!                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘                                              â†‘
           â”‚                                              â”‚
    Implemented by                                Implemented by
           â”‚                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                                            â”‚
â”‚                 (Repository Implementations)                                 â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               REPOSITORY IMPLEMENTATIONS                             â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  AuthRepositoryImpl                                      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  + Input validation (email, password format)            â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  + Calls RemoteAuthDataSource                           â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  + Caches user via LocalAuthDataSource                  â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  + Saves token via SecureTokenStorage                   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  + Maps failures to domain types                        â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  WalletRepositoryImpl (OFFLINE-FIRST!)                  â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  READ: getWalletBalance()                              â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Try remote                                         â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Fallback to local cache                            â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Return fresh or cached data                        â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  WRITE: transferFund()                                  â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Check online?                                      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ YES: Send to API, cache, return success           â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ NO: Queue locally (status: pendingSync), return   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  SYNC: syncPendingTransactions()                        â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Fetch all from queue (status: pendingSync)        â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Retry each to API                                  â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    â†’ Update status (success/failed)                     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Uses LocalWalletDataSource + RemoteWalletDataSource   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Handles errors gracefully (Either<Failure, T>)        â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    DATA SOURCES (Interfaces)                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ LOCAL DATA SOURCES (Drift Database)                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  LocalAuthDataSourceImpl:                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - cacheUser(user)                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getUserById(id)                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - clearUser()                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  LocalWalletDataSourceImpl:                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - cacheWallet(wallet, userId)                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getWalletCacheByUserId(userId)                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - queueTransaction(tx, userId)  â† KEY!                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getPendingSyncTransactions(userId)                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - updateTransactionStatus(id, status, ...)            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getTransactionHistory(userId)                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - clearWalletData()                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â†“ Uses AppDatabase (CRUD operations)                     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ REMOTE DATA SOURCES (Retrofit API)                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  RemoteAuthDataSourceImpl:                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - register(email, password, confirmPassword)           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - login(email, password) â†’ (user, token)               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getCurrentUser()                                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  RemoteWalletDataSourceImpl:                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getWalletBalance()                                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - transferFund(recipient, amount, note)                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    - getTransactionHistory(limit, offset)                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â†“ Uses ApiClient (Retrofit)                              â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚             DTOs & MAPPERS                                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  DTOs (API â†” Local):                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚ Request: LoginRequestDto, RegisterRequestDto,           â”‚      â”‚   â”‚
â”‚  â”‚  â”‚          TransferRequestDto                             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ Response: AuthResponseDto, UserResponseDto,             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚           WalletResponseDto, TransactionResponseDto     â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Mappers (Extension Methods):                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚ auth_mapper.dart: DTO â†” domain entities                 â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ wallet_mapper.dart: Wallet response â†” domain            â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ transaction_mapper.dart: Transaction response â†” domain  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ All support JSON serialization via JsonSerializable     â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CORE LAYER       â”‚               â”‚   EXTERNAL SERVICES  â”‚
â”‚                   â”‚               â”‚                      â”‚
â”‚ Database:         â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â€¢ Drift (SQLite)  â”‚               â”‚  â”‚  Backend API   â”‚  â”‚
â”‚ â€¢ Tables:         â”‚               â”‚  â”‚                â”‚  â”‚
â”‚   - UserCache     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ /auth/login    â”‚  â”‚
â”‚   - WalletCache   â”‚               â”‚  â”‚ /auth/register â”‚  â”‚
â”‚   - TransQueue    â”‚               â”‚  â”‚ /wallet/...    â”‚  â”‚
â”‚   - TxHistory     â”‚               â”‚  â”‚                â”‚  â”‚
â”‚                   â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                      â”‚
â”‚ Network:          â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â€¢ Dio (HTTP)      â”‚               â”‚  â”‚ Secure Storage â”‚  â”‚
â”‚ â€¢ Retrofit API    â”‚               â”‚  â”‚ (Keychain/     â”‚  â”‚
â”‚ â€¢ Retry (Exp.Bkf) â”‚               â”‚  â”‚  Keystore)     â”‚  â”‚
â”‚ â€¢ Logging         â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   â”‚               â”‚  (JWT tokens)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Storage:          â”‚
â”‚ â€¢ Secure tokens   â”‚
â”‚ â€¢ User ID         â”‚
â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DI:               â”‚
â”‚ â€¢ GetIt           â”‚
â”‚ â€¢ Injectable      â”‚
â”‚ â€¢ Service Locator â”‚
â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Offline Transaction Flow (Detailed)

```
USER INITIATES TRANSFER (In cave, no internet)
â”‚
â”œâ”€â†’ transferFund(recipient='john@example.com', amount=$100) called
â”‚
â”œâ”€â†’ Validation layer
â”‚   â”œâ”€ Email format? âœ“
â”‚   â”œâ”€ Amount > 0? âœ“
â”‚   â””â”€ User authenticated? âœ“
â”‚
â”œâ”€â†’ Create Transaction object
â”‚   {
â”‚     id: 'uuid-abc123',
â”‚     recipientEmail: 'john@example.com',
â”‚     amount: 100,
â”‚     status: pending,  â† Initial status
â”‚     timestamp: 2024-01-15T14:30:00Z
â”‚   }
â”‚
â”œâ”€â†’ Check connectivity
â”‚   â””â”€ Online? NO
â”‚
â”œâ”€â†’ Save to TransactionQueueTable
â”‚   {
â”‚     id: 'uuid-abc123',
â”‚     userId: 'user-456',
â”‚     recipientEmail: 'john@example.com',
â”‚     amount: 100,
â”‚     note: 'payment for lunch',
â”‚     status: 'pending_sync',  â† KEY STATUS
â”‚     timestamp: 2024-01-15T14:30:00Z,
â”‚     createdAt: 2024-01-15T14:30:15Z
â”‚   }
â”‚
â”œâ”€â†’ Return to UI
â”‚   Right(Transaction(status: pendingSync))
â”‚
â””â”€â†’ UI FEEDBACK
    "ğŸ“¤ Syncing... Transaction will send when you're online"
    Transaction shows in history with "Pending" badge


=== LATER: USER EXITS CAVE ===


â”Œâ”€â†’ Phone detects network signal
â”‚
â”œâ”€â†’ App detects connectivity restored
â”‚
â”œâ”€â†’ (Automatic or manual) Call syncPendingTransactions()
â”‚
â”œâ”€â†’ Fetch all from TransactionQueueTable
â”‚   WHERE status = 'pending_sync'
â”‚   â””â”€ Found: [Transaction(id: uuid-abc123, status: pending_sync)]
â”‚
â”œâ”€â†’ For each pending transaction:
â”‚
â”‚   â”œâ”€â†’ POST /wallet/transfer {
â”‚   â”‚     recipientEmail: 'john@example.com',
â”‚   â”‚     amount: 100,
â”‚   â”‚     note: 'payment for lunch'
â”‚   â”‚   }
â”‚   â”‚
â”‚   â”œâ”€â†’ Server response
â”‚   â”‚   Case 1: Success (201)
â”‚   â”‚   {
â”‚   â”‚     id: 'uuid-abc123',
â”‚   â”‚     status: 'success',
â”‚   â”‚     timestamp: 2024-01-15T14:35:00Z
â”‚   â”‚   }
â”‚   â”‚   â””â”€â†’ Update DB: status = 'success'
â”‚   â”‚
â”‚   â”‚   Case 2: Failure (400)
â”‚   â”‚   {
â”‚   â”‚     message: 'Insufficient funds'
â”‚   â”‚   }
â”‚   â”‚   â””â”€â†’ Update DB: status = 'failed', 
â”‚   â”‚       errorMessage = 'Insufficient funds'
â”‚   â”‚
â”‚   â””â”€â†’ Move to TransactionHistoryTable (if success)
â”‚
â””â”€â†’ UI UPDATES
    "âœ“ Synced! Transaction sent to john@example.com"
    OR
    "âŒ Failed: Insufficient funds. Please add funds."
```

---

## Data Flow: Balance Request (Offline-First)

```
UI requests wallet balance
â”‚
â”œâ”€â†’ WalletRepository.getWalletBalance()
â”‚
â”œâ”€â†’ RemoteWalletDataSource.getWalletBalance()
â”‚   â”‚
â”‚   â”œâ”€â†’ Try: GET /wallet/balance (with JWT)
â”‚   â”‚
â”‚   â”œâ”€â†’ Network available?
â”‚   â”‚   YES:
â”‚   â”‚   â”œâ”€â†’ Receive WalletResponseDto
â”‚   â”‚   â”‚   {
â”‚   â”‚   â”‚     balance: 50000,
â”‚   â”‚   â”‚     currency: 'IDR',
â”‚   â”‚   â”‚     last_updated: '2024-01-15T14:35:00Z'
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â†’ Map to domain: Wallet(balance: 50000, currency: IDR, ...)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â†’ Cache locally (WalletCacheTable)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â†’ Return: Right(Wallet(...))
â”‚   â”‚
â”‚   â””â”€â†’ NO network:
â”‚       â””â”€â†’ Throw: NetworkFailure('No internet')
â”‚
â”œâ”€â†’ Error handling in Repository
â”‚   â”‚
â”‚   NetworkFailure caught
â”‚   â”‚
â”‚   â”œâ”€â†’ Try: LocalWalletDataSource.getWalletCacheByUserId(userId)
â”‚   â”‚
â”‚   â”œâ”€â†’ Found in cache?
â”‚   â”‚   YES:
â”‚   â”‚   â””â”€â†’ Return: Right(CachedWallet(...))
â”‚   â”‚       UI shows: "$50,000 (last updated 2 hours ago)"
â”‚   â”‚
â”‚   â””â”€â†’ NOT in cache?
â”‚       â””â”€â†’ Return: Left(NetworkFailure(...))
â”‚           UI shows: "Cannot load balance. No cache available."
â”‚
â””â”€â†’ UI handles result
    result.fold(
      (failure) â†’ showError(failure.message),
      (wallet) â†’ displayBalance(wallet)
    )
```

---

## Code Generation Flow

```
â”Œâ”€ Developer writes code
â”‚
â”œâ”€ @freezed class User { ... }
â”œâ”€ @freezed class Wallet { ... }
â”œâ”€ @JsonSerializable() class UserResponseDto { ... }
â”œâ”€ @RestApi() abstract class ApiClient { ... }
â”œâ”€ @DataClassName(...) class UserCacheTable { ... }
â””â”€ @Injectable() class AuthRepositoryImpl { ... }
â”‚
â””â”€ Run: flutter pub run build_runner build
   â”‚
   â”œâ”€ Freezed generates:
   â”‚  â”œâ”€ user.freezed.dart (copyWith, ==, toString, factory)
   â”‚  â””â”€ wallet.freezed.dart
   â”‚
   â”œâ”€ JsonSerializable generates:
   â”‚  â”œâ”€ user_response_dto.g.dart (fromJson, toJson)
   â”‚  â””â”€ wallet_dto.g.dart
   â”‚
   â”œâ”€ Retrofit generates:
   â”‚  â””â”€ api_client.g.dart (HTTP implementation)
   â”‚
   â”œâ”€ Drift generates:
   â”‚  â””â”€ app_database.g.dart (Table definitions, queries)
   â”‚
   â””â”€ Injectable generates:
      â””â”€ service_locator.config.dart (DI setup)
â”‚
â””â”€ All files imported via: part 'file.freezed.dart';
```

---

## Error Handling Flow

```
Operations can fail in 5 ways:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FAILURE UNION TYPE                         â”‚
â”‚   Either<Failure, Success>                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚           â”‚           â”‚
        â†“           â†“           â†“           â†“
    NetworkFailure ServerFailure CacheFailure AuthFailure
        â”‚           â”‚           â”‚           â”‚
        â”‚           â”‚           â”‚           â””â”€ User not authenticated
        â”‚           â”‚           â”‚              or token expired
        â”‚           â”‚           â”‚
        â”‚           â”‚           â””â”€ Database error
        â”‚           â”‚              or query failed
        â”‚           â”‚
        â”‚           â””â”€ API returned 4xx or 5xx
        â”‚              with error message
        â”‚
        â””â”€ SocketException, timeout, 
           no internet (RETRY ATTEMPTS)

Every repository method returns:
Future<Either<Failure, T>>

Caller MUST handle both cases:
result.fold(
  (failure) {
    // Handle error
    switch (failure) {
      case NetworkFailure() â†’ retry or show cached
      case ServerFailure() â†’ show error message
      case AuthFailure() â†’ redirect to login
      case _ â†’ show generic error
    }
  },
  (success) {
    // Use success value
  }
)
```

---

## Complete Request/Response Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User taps UI   â”‚  "Transfer $100 to john@example.com"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presentation Layer calls:            â”‚
â”‚ walletRepo.transferFund(...)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WalletRepositoryImpl.transferFund()                           â”‚
â”‚ â€¢ Validates input                                            â”‚
â”‚ â€¢ Checks connectivity                                        â”‚
â”‚ â”œâ”€ Online: calls RemoteWalletDataSource                     â”‚
â”‚ â”‚  â”‚                                                         â”‚
â”‚ â”‚  â””â”€â†’ POST /wallet/transfer (via Retrofit/Dio)             â”‚
â”‚ â”‚      â€¢ RetryInterceptor (auto-retry 3x)                   â”‚
â”‚ â”‚      â€¢ AuthInterceptor (adds JWT)                         â”‚
â”‚ â”‚      â€¢ Exponential backoff if fails                       â”‚
â”‚ â”‚      â”‚                                                     â”‚
â”‚ â”‚      â”œâ”€ Success: TransactionResponseDto                   â”‚
â”‚ â”‚      â”‚           TransactionMapper.toDomain() â†’ Transaction
â”‚ â”‚      â”‚           Cache in WalletCacheTable                â”‚
â”‚ â”‚      â”‚           Return: Right(Transaction(...))          â”‚
â”‚ â”‚      â”‚                                                     â”‚
â”‚ â”‚      â””â”€ Failure: NetworkFailure/ServerFailure             â”‚
â”‚ â”‚                  Queue transaction instead!              â”‚
â”‚ â”‚                                                           â”‚
â”‚ â””â”€ Offline: Skip RemoteDataSource entirely                 â”‚
â”‚            Save to TransactionQueueTable with              â”‚
â”‚            status: 'pending_sync'                          â”‚
â”‚            Return: Right(Transaction(status: pendingSync)) â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI receives Either<F, Tx>    â”‚
â”‚                              â”‚
â”‚ .fold(                       â”‚
â”‚   (failure) â†’ showError(),   â”‚
â”‚   (tx) â†’ {                   â”‚
â”‚     if (tx.isPendingSync) {  â”‚
â”‚       show "Syncing..."      â”‚
â”‚     } else {                 â”‚
â”‚       show "Success!"        â”‚
â”‚     }                        â”‚
â”‚   }                          â”‚
â”‚ )                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This architecture provides:

âœ… **Clear separation** of concerns (Domain, Data, Core)
âœ… **Offline-first** transactions (queue + sync)
âœ… **Type safety** (Freezed, fpdart, Retrofit, Drift)
âœ… **Automatic retry** on network errors
âœ… **Secure token** storage
âœ… **Immutable models** (no mutation bugs)
âœ… **Comprehensive error** handling
âœ… **Dependency injection** (testable)
âœ… **Code generation** (less boilerplate)

All working together to create a **robust, maintainable, offline-capable** wallet application!
